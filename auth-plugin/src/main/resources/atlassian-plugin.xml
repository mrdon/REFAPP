<atlassian-plugin key="${atlassian.plugin.key}" name="${pom.name}" pluginsVersion="2">
    <plugin-info>
        <description>${pom.description}</description>
        <version>${pom.version}</version>
        <vendor name="${pom.organization.name}" url="${pom.organization.url}" />
        <bundle-instructions>
            <Export-Package>
                com.atlassian.user,com.atlassian.user.util,com.atlassian.user.security.authentication,
                com.atlassian.seraph.auth,com.atlassian.seraph.config</Export-Package>
        </bundle-instructions>
    </plugin-info>
    
    <component key="repositoryIdentifier" class="com.atlassian.refapp.auth.internal.AuthPluginRepositoryIdentifier">
        <interface>com.atlassian.user.repository.RepositoryIdentifier</interface>
    </component>
    <component key="memoryProvider" class="com.atlassian.user.impl.memory.provider.MemoryProvider" />

    <component key="passwordEncryptor" class="com.atlassian.user.impl.osuser.security.password.OSUPasswordEncryptor" public="true">
        <interface>com.atlassian.user.security.password.PasswordEncryptor</interface>
    </component>    
    <component key="userManager" class="com.atlassian.user.impl.memory.MemoryUserManager" public="true">
        <interface>com.atlassian.user.UserManager</interface>
    </component>
    <component key="groupManager" class="com.atlassian.user.impl.memory.MemoryGroupManager" public="true">
        <interface>com.atlassian.user.GroupManager</interface>
    </component>
    <component key="userAuthenticator" class="com.atlassian.user.security.authentication.DefaultAuthenticator" public="true">
        <interface>com.atlassian.user.security.authentication.Authenticator</interface>
    </component>
    <component key="authenticationContext" class="com.atlassian.seraph.auth.AuthenticationContextImpl" public="true">
        <interface>com.atlassian.seraph.auth.AuthenticationContext</interface>
    </component>
    <component key="roleMapper" class="com.atlassian.refapp.auth.internal.GroupRoleMapper" public="true">
        <interface>com.atlassian.seraph.auth.RoleMapper</interface>
    </component>
    
    <component key="seraphAuthenticator" class="com.atlassian.refapp.auth.internal.AtlassianUserAuthenticator" />
    <component key="authenticationInitialization" class="com.atlassian.refapp.auth.internal.AuthenticationInitialization" />
    
    <servlet-filter key="login-filter" class="com.atlassian.seraph.filter.LoginFilter" location="before-login" weight="1000000">
        <url-pattern>/*</url-pattern>
    </servlet-filter>
    <servlet-filter key="security" class="com.atlassian.seraph.filter.SecurityFilter" location="before-login" weight="1000001">
        <url-pattern>/*</url-pattern>
        <init-param>
            <param-name>config.file</param-name>
            <param-value>/seraph-config.xml</param-value>
        </init-param>
    </servlet-filter>
    <servlet-filter key="copy-authentication-context" class="com.atlassian.refapp.auth.internal.AuthenticationContextCopyFilter" location="before-login" weight="1000001">
        <url-pattern>/*</url-pattern>
    </servlet-filter>
    
    <servlet key="login-servlet" class="com.atlassian.refapp.auth.internal.LoginServlet">
        <url-pattern>/login</url-pattern>
    </servlet>
    
    <servlet key="logout" class="com.atlassian.refapp.auth.internal.LogoutServlet">
        <url-pattern>/logout</url-pattern>
    </servlet>

    <servlet key="users-servlet" class="com.atlassian.refapp.auth.internal.UsersServlet">
        <url-pattern>/users</url-pattern>
        <url-pattern>/users/*</url-pattern>
    </servlet>

    <web-item key="userManagementLink" section="system.admin/general" weight="10">
        <label key="User Management"/>
        <link linkId="userManagement">/plugins/servlet/users</link>
    </web-item>

    <web-item key="loginLink" section="footer.links" weight="40">
        <label key="Login"/>
        <link linkId="login">/plugins/servlet/login</link>
    </web-item>

</atlassian-plugin>
